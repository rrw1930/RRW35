<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>综合泵站水泵系统能源诊断报告</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --primary-color: #1a5276;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --border-radius: 5px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding-bottom: 50px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 封面样式 - 增加高度避免重叠 */
        .cover-page {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            min-height: 150vh; /* 增加封面高度 */
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .cover-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }
        
        .cover-logo {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .cover-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .company-info {
            text-align: right;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }
        
        .company-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .report-title {
            font-size: 2.2rem;
            margin: 20px 0;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .cover-content {
            display: flex;
            flex: 1;
            position: relative;
            min-height: 600px; /* 增加内容区域高度 */
        }
        
        .toc {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            margin: 0 auto;
            max-width: 600px;
            margin-bottom: 30px; /* 增加底部间距 */
        }
        
        .toc h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .toc-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.3);
        }
        
        .info-approval-section {
            position: absolute;
            bottom: 40px; /* 增加底部间距 */
            right: 0;
            width: 45%;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
        }
        
        .info-approval-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .info-approval-table th, 
        .info-approval-table td {
            padding: 6px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.75rem;
            background-color: transparent;
        }
        
        .info-approval-table th {
            font-weight: 600;
            width: 25%;
            color: #000; /* 表头字体改为黑色 */
            background-color: rgba(255, 255, 255, 0.3); /* 表头背景加深 */
        }
        
        .info-approval-table td {
            width: 25%;
            color: #000; /* 表格内容字体改为黑色 */
        }
        
        /* 报告内容样式 */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .report-header {
            text-align: center;
        }
        
        .report-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .report-meta {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .meta-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: var(--border-radius);
        }
        
        section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }
        
        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.6rem;
        }
        
        h3 {
            color: var(--dark-color);
            margin: 20px 0 10px;
            font-size: 1.3rem;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--light-color);
            color: var(--dark-color);
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .highlight {
            background-color: #fff9e6;
            padding: 15px;
            border-left: 4px solid var(--warning-color);
            margin: 15px 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .badge-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--secondary-color);
        }
        
        .summary-card h4 {
            color: var(--dark-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .summary-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .summary-card .unit {
            color: #777;
            font-size: 0.9rem;
        }
        
        .recommendation {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid;
            background-color: #f8f9fa;
        }
        
        .recommendation.high {
            border-color: var(--danger-color);
        }
        
        .recommendation.medium {
            border-color: var(--warning-color);
        }
        
        .recommendation.low {
            border-color: var(--success-color);
        }
        
        .recommendation .priority {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #777;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
        }
        
        .chart-container {
            background: #f0f0f0;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            border-radius: var(--border-radius);
            color: #777;
            position: relative;
            overflow: hidden;
        }
        
        .chart-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
        }
        
        .topology-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: white;
            padding: 20px;
        }
        
        .sankey-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: white;
            padding: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .chart-title {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 8px 10px;
            }
            
            .cover-content {
                flex-direction: column;
            }
            
            .cover-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .company-info {
                text-align: center;
                margin-top: 20px;
            }
            
            .info-approval-section {
                position: static;
                width: 100%;
                margin-top: 20px;
            }
            
            .toc {
                margin-right: 0;
                max-width: 100%;
            }
        }
        
        /* 导航按钮 */
        .nav-buttons {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }
        
        .nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }
        
        /* 打印样式 */
        @media print {
            .nav-buttons {
                display: none;
            }
            
            .cover-page {
                page-break-after: always;
            }
            
            section {
                page-break-inside: avoid;
            }
        }
        /* 桑基图样式 */
        .sankey-node rect {
            fill-opacity: 0.8;
            shape-rendering: crispEdges;
        }
        
        .sankey-node text {
            pointer-events: none;
            text-shadow: 0 1px 0 #fff;
        }
        
        .sankey-link {
            fill: none;
            stroke: #000;
            stroke-opacity: 0.2;
        }
        
        .sankey-link:hover {
            stroke-opacity: 0.5;
        }
        
        /* 性能曲线图样式 */
        .performance-chart-container {
            height: 500px;
        }
        
        /* 时间推移图样式 */
        .time-series-chart {
            height: 350px;
        }
        
        /* 规则诊断卡片 */
        .rule-card {
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin: 15px 0;
            background-color: #f8f9fa;
        }
        
        .rule-card h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .rule-card.triggered {
            border-left-color: var(--danger-color);
            background-color: #ffeaea;
        }
        
        /* 改进区域样式 */
        .improvement-area {
            fill: rgba(255, 255, 0, 0.3);
            stroke: #ffcc00;
            stroke-width: 2;
        }
        
        /* 数据表格样式增强 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .data-table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .kpi-table td:last-child {
            font-weight: bold;
        }
        
        /* 章节导航 */
        .chapter-nav {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        .chapter-nav a {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }
        
        .chapter-nav a:hover {
            background-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- 封面/目录页 - 增加高度避免重叠 -->
    <div class="cover-page">
        <div class="cover-header">
            <div class="cover-logo">
                <img src="https://github.com/rrw1930/RRW34/blob/main/%E6%97%A5%E4%BA%A7logo.png?raw=true" alt="日产汽车LOGO">
            </div>
            
            <div class="company-info">
                <div class="company-name">深圳德尔科公司</div>
                <div>地址: 广州市花都区百业广场</div>
                <div>电话: 400-123-4567</div>
                <div>邮箱: contact@delco.com</div>
            </div>
        </div>
        
        <h1 class="report-title">综合泵站水泵系统能源诊断报告</h1>
        
        <div class="cover-content">
            <div class="toc">
                <h3>报告目录</h3>
                <div class="toc-item">
                    <span>第1章 执行摘要</span>
                    <span>1</span>
                </div>
                <div class="toc-item">
                    <span>第2章 系统概况与拓扑分析</span>
                    <span>2</span>
                </div>
                <div class="toc-item">
                    <span>第3章 数据质量与能量平衡验证</span>
                    <span>3</span>
                </div>
                <div class="toc-item">
                    <span>第4章 H-Q曲线分析与运行区间诊断</span>
                    <span>4</span>
                </div>
                <div class="toc-item">
                    <span>第5章 能量流分析与桑基图构建</span>
                    <span>5</span>
                </div>
                <div class="toc-item">
                    <span>第6章 规则诊断与详细分析</span>
                    <span>6</span>
                </div>
                <div class="toc-item">
                    <span>第7章 变频与机械专项分析</span>
                    <span>7</span>
                </div>
                <div class="toc-item">
                    <span>第8章 优化对策与实施路线图</span>
                    <span>8</span>
                </div>
                <div class="toc-item">
                    <span>第9章 效益量化与投资分析</span>
                    <span>9</span>
                </div>
                <div class="toc-item">
                    <span>第10章 结论与建议</span>
                    <span>10</span>
                </div>
                <div class="toc-item">
                    <span>附录</span>
                    <span>11</span>
                </div>
            </div>
            
            <div class="info-approval-section">
                <table class="info-approval-table">
                    <tr>
                        <th>报告编号:</th>
                        <td>HD-2025-009-CN</td>
                        <th>诊断日期:</th>
                        <td>2025年9月23日</td>
                    </tr>
                    <tr>
                        <th>报告版本:</th>
                        <td>V1.0</td>
                        <th>工厂名称:</th>
                        <td>综合泵站</td>
                    </tr>
                    <tr>
                        <th>设备名称:</th>
                        <td>P-101/P-102水泵系统</td>
                        <th>诊断时间:</th>
                        <td>2025年9月15日-9月22日</td>
                    </tr>
                    <tr>
                        <th>诊断部位:</th>
                        <td>供水系统核心设备</td>
                        <th>诊断人员:</th>
                        <td>李明、张华、王强</td>
                    </tr>
                    <tr>
                        <th>作成:</th>
                        <td>李明 (日期: 2025年9月23日)</td>
                        <th>审核:</th>
                        <td>张华 (日期: 2025年9月24日)</td>
                    </tr>
                    <tr>
                        <th>批准:</th>
                        <td>王强 (日期: 2025年9月25日)</td>
                        <th>报告状态:</th>
                        <td>已完成</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- 导航按钮 -->
    <div class="nav-buttons">
        <div class="nav-btn" onclick="scrollToSection('executive-summary')">
            <i class="fas fa-home"></i>
        </div>
        <div class="nav-btn" onclick="scrollToSection('system-overview')">
            <i class="fas fa-project-diagram"></i>
        </div>
        <div class="nav-btn" onclick="scrollToSection('data-quality')">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="nav-btn" onclick="scrollToSection('performance-analysis')">
            <i class="fas fa-chart-bar"></i>
        </div>
        <div class="nav-btn" onclick="scrollToSection('energy-flow')">
            <i class="fas fa-water"></i>
        </div>
        <div class="nav-btn" onclick="scrollToTop()">
            <i class="fas fa-arrow-up"></i>
        </div>
    </div>

    <!-- 报告正文 -->
    <div class="container">
        <header>
            <div class="report-header">
                <h1>综合泵站水泵系统能源诊断报告</h1>
                <div class="report-meta">
                    <div class="meta-item"><strong>报告编号:</strong> HD-2025-009-CN</div>
                    <div class="meta-item"><strong>生成日期:</strong> 2025-09-23</div>
                    <div class="meta-item"><strong>诊断依据:</strong> 《Pump_Energy_Diagnostics_Rules_v4_Expanded_CN》</div>
                </div>
            </div>
        </header>

        <section id="executive-summary">
            <h2>第1章 执行摘要</h2>
            
            <h3>1.1 项目概况</h3>
            <p>本报告基于《rules_frontend_table_v5_all.xlsx》规则引擎对综合泵站进行能源诊断。该规则库包含R1-R12基础问题规则、G1-G9并联/串联及变频专项规则、E1-E15运行区间细分规则，形成完整的诊断体系。诊断数据来源于2025年9月连续采集的IoT数据，涵盖流量、压力、功率等关键参数。</p>
            
            <h3>1.2 核心诊断结论</h3>
            <p>本次诊断发现，当前系统运行存在显著能效提升空间，主要问题集中于以下四个方面：</p>
            <ol>
                <li><strong>严重节流损失：</strong>系统为满足下游恒压需求，主要依靠关小出口阀门进行调节，导致大量电能浪费在阀门节流上，此为最大的能耗黑洞。阀损比F_valve高达18.5%，远超10%的阈值。</li>
                <li><strong>过滤器阻塞：</strong>过滤器压差ΔP_str达到0.25bar，超过0.20bar的预警值，增加了系统阻力损失。</li>
                <li><strong>运行点偏离高效区：</strong>水泵长期在低效区（额定流量70%以下）运行，远离最佳效率点（BEP），80%运行点处于低效区间。</li>
                <li><strong>机械传动链损耗异常：</strong>经能量闭合验证，系统残余功率（P_res）占比偏高，达到7.1%，推测由泵内部磨损和/或设备对中不良导致。</li>
            </ol>
            
            <h3>1.3 关键量化指标（诊断窗口期快照）</h3>
            <table class="data-table kpi-table">
                <thead>
                    <tr>
                        <th>关键性能指标 (KPI)</th>
                        <th>数值</th>
                        <th>单位</th>
                        <th>参考理想值</th>
                        <th>评估</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>平均系统运行效率</td>
                        <td>55.2</td>
                        <td>%</td>
                        <td>&gt; 65%</td>
                        <td><span class="badge badge-danger">偏低</span></td>
                    </tr>
                    <tr>
                        <td>平均阀损比 (F_valve)</td>
                        <td>18.5</td>
                        <td>%</td>
                        <td>&lt; 5%</td>
                        <td><span class="badge badge-danger">严重</span></td>
                    </tr>
                    <tr>
                        <td>平均过滤器压差 (ΔP_str)</td>
                        <td>0.25</td>
                        <td>bar</td>
                        <td>&lt; 0.15 bar</td>
                        <td><span class="badge badge-warning">偏高</span></td>
                    </tr>
                    <tr>
                        <td>平均BEP驻留率 (r_Q ∈ [0.9,1.1])</td>
                        <td>35.2</td>
                        <td>%</td>
                        <td>&gt; 70%</td>
                        <td><span class="badge badge-danger">偏低</span></td>
                    </tr>
                    <tr>
                        <td>能量平衡闭合误差</td>
                        <td>3.8</td>
                        <td>%</td>
                        <td>≤ 5%</td>
                        <td><span class="badge badge-success">合格</span></td>
                    </tr>
                </tbody>
            </table>
            
            <h3>1.4 预期节能潜力</h3>
            <p>基于诊断结果与规则库中的量化公式进行计算，预计通过实施本报告提出的优化措施，系统可获得可观的节能效益：</p>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <h4>总预期节功率</h4>
                    <div class="value">28.7 <span class="unit">kW</span></div>
                    <p>通过优化措施可节约的功率</p>
                </div>
                <div class="summary-card">
                    <h4>年节电量</h4>
                    <div class="value">227,424 <span class="unit">kWh</span></div>
                    <p>按年运行330天计算</p>
                </div>
                <div class="summary-card">
                    <h4>年节电费</h4>
                    <div class="value">18.2 <span class="unit">万元</span></div>
                    <p>按0.8元/kWh计算</p>
                </div>
                <div class="summary-card">
                    <h4>年二氧化碳减排量</h4>
                    <div class="value">226.7 <span class="unit">吨</span></div>
                    <p>按0.997 kg-CO₂/kWh计算</p>
                </div>
            </div>
            
            <h3>1.5 优先行动建议</h3>
            
            <div class="recommendation high">
                <div class="priority">立即执行 (1周内)</div>
                <p>清洗#2过滤器，当前压差已达0.7bar，严重超出0.2bar的警戒阈值。</p>
            </div>
            
            <div class="recommendation high">
                <div class="priority">高优先级 (1个月内)</div>
                <p>调整P-101泵的控制设定值，尝试在允许范围内适当降低出口压力设定，并开大阀门，观察系统响应。为变频改造（VFD）提供数据支撑。</p>
            </div>
            
            <div class="recommendation high">
                <div class="priority">高优先级 (下次检修时)</div>
                <p>对P-201泵组安排机械对中检查和轴承、密封环状态检查，以解决高残余功率问题。</p>
            </div>
            
            <div class="chapter-nav">
                <a href="#system-overview">下一章：系统概况与拓扑分析 &rarr;</a>
            </div>
        </section>

        <section id="system-overview">
            <h2>第2章 系统概况与拓扑分析</h2>
            
            <h3>2.1 系统边界定义</h3>
            <p>根据《02_System_Topology_CN.docx》，系统边界明确：</p>
            <ul>
                <li><strong>起始点：</strong>吸入池液面</li>
                <li><strong>终止点：</strong>管网输送末端</li>
                <li><strong>包含设备：</strong>泵组、阀门、过滤器、管道系统</li>
                <li><strong>排除范围：</strong>上游水源和下游用户端设备</li>
            </ul>
            
            <h3>2.2 设备拓扑结构</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>设备编号</th>
                        <th>设备类型</th>
                        <th>上下游关联</th>
                        <th>功能描述</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>P-101</td>
                        <td>离心泵</td>
                        <td>吸入池→出口阀</td>
                        <td>主输送设备（一用）</td>
                    </tr>
                    <tr>
                        <td>P-102</td>
                        <td>离心泵</td>
                        <td>吸入池→出口阀</td>
                        <td>备用输送设备（一备）</td>
                    </tr>
                    <tr>
                        <td>CV-101</td>
                        <td>控制阀</td>
                        <td>泵出口→过滤器</td>
                        <td>流量调节</td>
                    </tr>
                    <tr>
                        <td>STR-201</td>
                        <td>过滤器</td>
                        <td>控制阀→主管网</td>
                        <td>介质过滤</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>2.3 系统拓扑图</h3>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <div class="chart-title">综合泵站水泵系统拓扑图</div>
                    <img src="https://github.com/rrw1930/RRW32/blob/main/index.jpg?raw=true" alt="系统拓扑图" class="topology-img">
                </div>
            </div>
            
            <h3>2.4 测点布置与数据源</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>TagID</th>
                        <th>物理量</th>
                        <th>单位</th>
                        <th>安装位置</th>
                        <th>用途</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>FT-201</td>
                        <td>流量</td>
                        <td>m³/h</td>
                        <td>主管道</td>
                        <td>计算Q</td>
                    </tr>
                    <tr>
                        <td>PT-101</td>
                        <td>压力</td>
                        <td>bar_g</td>
                        <td>P-101泵出口</td>
                        <td>计算H</td>
                    </tr>
                    <tr>
                        <td>PT-102</td>
                        <td>压力</td>
                        <td>bar_g</td>
                        <td>过滤器STR-201后</td>
                        <td>计算ΔP_str</td>
                    </tr>
                    <tr>
                        <td>PE-101</td>
                        <td>电功率</td>
                        <td>kW</td>
                        <td>P-101电机配电柜</td>
                        <td>计算P_elec</td>
                    </tr>
                    <tr>
                        <td>ZT-101</td>
                        <td>阀门开度</td>
                        <td>%</td>
                        <td>CV-101</td>
                        <td>判断节流</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>2.5 运行模式</h3>
            <p>当前系统采用"恒压控制"模式，通过调节出口阀门CV-101的开度（通常在40%-60%之间），将管网压力维持在4.8 bar。水泵P-101以工频（50Hz）定速运行。</p>
            
            <h3>2.6 拓扑优化建议</h3>
            <p>虽然当前为单泵系统，但根据G1并联规则，建议：</p>
            <ul>
                <li>考虑增设小流量备用泵</li>
                <li>优化泵切换逻辑，设置20-30分钟滞回时间</li>
                <li>在主管道增加压力监测点，提高控制精度</li>
            </ul>
            
            <div class="chapter-nav">
                <a href="#executive-summary">&larr; 上一章：执行摘要</a>
                <a href="#data-quality">下一章：数据质量与能量平衡验证 &rarr;</a>
            </div>
        </section>

        <section id="data-quality">
            <h2>第3章 数据质量与能量平衡验证</h2>
            
            <h3>3.1 数据预处理流程</h3>
            <p>依据《03_Data_Quality_CN.docx》要求，为确保分析准确性，对原始数据进行了以下预处理：</p>
            <ul>
                <li><strong>时间对齐与聚合:</strong> 将1s高频原始数据统一采样至1分钟间隔，并聚合为5分钟稳态窗口数据进行诊断分析。</li>
                <li><strong>稳态识别:</strong> 采用滑窗法（窗口长度：10分钟），设定阈值：σ(Q)/Q &lt; 4%, σ(H)/H &lt; 4%，成功从72小时数据中提取出 <strong>86个</strong> 有效稳态工况点。</li>
                <li><strong>异常值处理:</strong> 发现并处理了2个因传感器瞬时干扰导致的跳变点，数据缺失率&lt;1%，通过线性插值补充。</li>
            </ul>
            
            <h3>3.2 原始数据趋势图</h3>
            <div class="chart-container time-series-chart">
                <div class="chart-wrapper">
                    <div class="chart-title">72小时原始数据趋势 (流量、压力、功率)</div>
                    <canvas id="rawDataChart"></canvas>
                </div>
            </div>
            
            <h3>3.3 能量平衡验证</h3>
            <p>能量闭合是验证数据可靠性的核心。我们对每个稳态点进行了输入（电功）与输出（水力功+各种损耗）的能量平衡计算。</p>
            <ul>
                <li><strong>验证公式:</strong> 能量平衡误差 = |P_elec - (P_hyd + P_thrtl + P_str + P_bp + P_res)| / P_elec * 100%</li>
                <li><strong>验证标准:</strong> 误差 ≤ 5% 为可接受。</li>
                <li><strong>验证结果:</strong> 所有86个稳态点的平均能量平衡误差为 <strong>3.8%</strong>，最大误差为 <strong>6.2%</strong>（仅1个点）。除该点外，其余均低于5%。</li>
            </ul>
            
            <h3>3.4 数据质量评估</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>数据质量指标</th>
                        <th>评估结果</th>
                        <th>符合性</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>稳态数据占比</td>
                        <td>87.5%</td>
                        <td>优秀</td>
                    </tr>
                    <tr>
                        <td>传感器完好率</td>
                        <td>100%</td>
                        <td>优秀</td>
                    </tr>
                    <tr>
                        <td>通信中断率</td>
                        <td>0.2%</td>
                        <td>良好</td>
                    </tr>
                    <tr>
                        <td>数据时间对齐误差</td>
                        <td>&lt;5s</td>
                        <td>优秀</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="highlight">
                <p><strong>结论：</strong>数据质量良好，可用于高置信度的诊断分析。</p>
            </div>
            
            <div class="chapter-nav">
                <a href="#system-overview">&larr; 上一章：系统概况与拓扑分析</a>
                <a href="#performance-analysis">下一章：H-Q曲线分析与运行区间诊断 &rarr;</a>
            </div>
        </section>

        <section id="performance-analysis">
            <h2>第4章 H-Q曲线分析与运行区间诊断</h2>
            
            <h3>4.1 理论性能曲线与系统曲线</h3>
            <ul>
                <li><strong>厂家曲线:</strong> 以P-101泵为例，其额定转速（50Hz）下的出厂性能曲线（H-Q, η-Q）作为基准线绘制于下图中。</li>
                <li><strong>系统特性曲线:</strong> 根据86个稳态点的(Q, H)数据，拟合出系统实际阻力特性曲线为 H_sys = 45 + 0.0056 * Q^2 (H单位: m, Q单位: m³/h)。该曲线反映了管路本身的固有特性。</li>
            </ul>
            
            <h3>4.2 实际运行点与区域判定</h3>
            <div class="chart-container performance-chart-container">
                <div class="chart-wrapper">
                    <div class="chart-title">水泵性能曲线与实际运行点分布</div>
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
            
            <p>将86个稳态点经预处理后，投影到性能曲线图上。</p>
            <ul>
                <li><strong>发现:</strong> 超过80%的运行点位于 <strong>低流量区 (r_Q &lt; 0.7)</strong>，即长期在额定流量的70%以下运行。</li>
                <li><strong>偏离度分析:</strong> 计算各点的曲线偏离度(d_curve)，平均值为0.12，属于"Off"级别，表明实际扬程普遍低于厂家曲线预期，暗示可能存在<strong>内部磨损</strong>或<strong>汽蚀</strong>。</li>
                <li><strong>效率评估:</strong> 平均运行效率为55.2%，与厂家提供的BEP效率72%相比，<strong>绝对效率差值(Δη_pp)高达16.8个百分点</strong>，效率提升潜力巨大。</li>
            </ul>
            
            <h3>4.3 运行区间划分结果</h3>
            <p>基于E规则矩阵，运行点分布：</p>
            <ul>
                <li><strong>E02区间（very_low-off）：</strong>82%运行点</li>
                <li><strong>E07区间（bep-near）：</strong>12%运行点</li>
                <li><strong>E10区间（high-near）：</strong>6%运行点</li>
            </ul>
            
            <h3>4.4 关键参数计算</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>参数</th>
                        <th>计算公式</th>
                        <th>实测值</th>
                        <th>阈值</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>r_Q</td>
                        <td>Q_ref/Q_BEP</td>
                        <td>0.65</td>
                        <td>&lt;0.70</td>
                    </tr>
                    <tr>
                        <td>d_curve</td>
                        <td>√[(ΔQ/Q_BEP)²+(ΔH/H_BEP)²]</td>
                        <td>0.08</td>
                        <td>0.05-0.10</td>
                    </tr>
                    <tr>
                        <td>F_valve</td>
                        <td>H_valve/H_ref</td>
                        <td>0.185</td>
                        <td>≥0.10</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>4.5 核心问题定位</h3>
            <p>运行点密集分布于低效区，且与系统曲线交点远高于实际需求压力，这<strong>直接证明了阀门CV-101存在严重的节流调节</strong>，大量能量被白白消耗。</p>
            
            <div class="chapter-nav">
                <a href="#data-quality">&larr; 上一章：数据质量与能量平衡验证</a>
                <a href="#energy-flow">下一章：能量流分析与桑基图构建 &rarr;</a>
            </div>
        </section>

        <section id="energy-flow">
            <h2>第5章 能量流分析与桑基图构建</h2>
            
            <h3>5.1 能量分解明细</h3>
            <p>选取一个代表性稳态窗口（Q=185 m³/h, H=68m, P_elec=45.2kW）进行详细能量流分解：</p>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>能量流组分</th>
                        <th>功率值(kW)</th>
                        <th>占比</th>
                        <th>主要成因</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>P_hyd有用功</td>
                        <td>34.1</td>
                        <td>75.4%</td>
                        <td>有效输送能量</td>
                    </tr>
                    <tr>
                        <td>P_thrtl节流损失</td>
                        <td>6.8</td>
                        <td>15.0%</td>
                        <td>阀门节流</td>
                    </tr>
                    <tr>
                        <td>P_str过滤器损失</td>
                        <td>1.1</td>
                        <td>2.4%</td>
                        <td>滤网阻力</td>
                    </tr>
                    <tr>
                        <td>P_res残余损失</td>
                        <td>3.2</td>
                        <td>7.1%</td>
                        <td>机械传动损耗</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>5.2 桑基图 (Sankey Diagram)</h3>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <div class="chart-title">能量流桑基图 (输入电能45.2kW的分配)</div>
                    <img src="https://github.com/rrw1930/RRW32/blob/main/%E6%A1%91%E5%9F%BA%E5%9B%BE.png?raw=true" alt="能量流桑基图" class="topology-img">
                </div>
            </div>
            
            <h3>5.3 损失优先级排序</h3>
            <ol>
                <li><strong>节流损失（6.8 kW）：</strong>R1规则触发，优先处理</li>
                <li><strong>机械损失（3.2 kW）：</strong>R4规则预警，需要监测</li>
                <li><strong>过滤器损失（1.1 kW）：</strong>R2规则触发，次优先</li>
            </ol>
            
            <h3>5.4 分析结论</h3>
            <p>桑基图清晰揭示，<strong>节流损失是最大的能耗去向</strong>，占比高达15%，远超5%的合理范围。其次是传动链损失（7.1%），也略高于5%的经验值，印证了第4章关于机械损耗的推测。</p>
            
            <div class="chapter-nav">
                <a href="#performance-analysis">&larr; 上一章：H-Q曲线分析与运行区间诊断</a>
                <a href="#rules-analysis">下一章：规则诊断与详细分析 &rarr;</a>
            </div>
        </section>

        <section id="rules-analysis">
            <h2>第6章 规则诊断与详细分析</h2>
            <p>本章基于诊断规则引擎（v2.1）对具体问题进行逐项诊断。</p>
            
            <div class="rule-card triggered">
                <h4>6.1 R1规则：节流损失分析</h4>
                <p><strong>触发证据:</strong> 阀位开度长期处于40-60%，F_valve = 18.5% &gt; 10% (阈值)。</p>
                <p><strong>根本原因:</strong> "恒压控制"模式设计缺陷，采用落后的"定速泵+调节阀"方案，而非"变频泵+全开阀"的先进方案。</p>
                <p><strong>优化对策:</strong></p>
                <ul>
                    <li><strong>P1 (优先):</strong> 评估并实施变频调速改造（VFD）。将CV-101阀门固定在全开位置，通过变频器调节P-101泵的转速来改变流量和压力，从根本上消除节流损失。</li>
                    <li><strong>P2 (短期):</strong> 若暂不改造，优化压力设定值。在满足工艺下限的前提下，尝试将压力设定值从4.8bar降至4.5bar，可立即降低节流损失。</li>
                </ul>
                <p><strong>量化效益:</strong> 实施VFD后，预计可回收大部分节流损失，节功率 ΔP_thrtl ≈ 6.8 kW。</p>
            </div>
            
            <div class="rule-card triggered">
                <h4>6.2 R2规则：过滤器阻塞分析</h4>
                <p><strong>触发证据:</strong> ΔP_str = 0.25 bar &gt; 0.2 bar (警戒阈值)。</p>
                <p><strong>根本原因:</strong> 过滤器清洗维护周期过长，滤网部分堵塞。</p>
                <p><strong>优化对策:</strong></p>
                <ul>
                    <li><strong>P1 (立即):</strong> 立即安排清洗STR-201过滤器。</li>
                    <li><strong>P2 (长期):</strong> 优化清洗维护规程，将压差报警阈值设定为0.2bar，达到即清洗。</li>
                </ul>
                <p><strong>量化效益:</strong> 清洗后，预计压差可降至0.1bar以下，节功率 ΔP_str ≈ 0.5 kW。</p>
            </div>
            
            <div class="rule-card triggered">
                <h4>6.3 R4/R5规则：机械效率低 & 传动链异常分析</h4>
                <p><strong>触发证据:</strong> 残余功率 P_res ≈ 3.2 kW，占比7.1% &gt; 5%。且性能曲线显示扬程整体下移。</p>
                <p><strong>根本原因:</strong> 泵长期运行，内部密封环磨损导致间隙增大，内部泄漏加剧。同时，不排除联轴器对中存在轻微偏差。</p>
                <p><strong>优化对策:</strong></p>
                <ul>
                    <li><strong>P1 (检修):</strong> 在下次计划检修时，解体检修P-201泵，重点检查并更换叶轮密封环，恢复设计间隙。</li>
                    <li><strong>P2 (检查):</strong> 进行激光对中校正，确保电机与泵的对中精度。</li>
                </ul>
                <p><strong>量化效益:</strong> 修复后，预计可提升泵效5-8个百分点，节功率 ΔP_mech ≈ 2.2 kW。</p>
            </div>
            
            <div class="rule-card">
                <h4>6.4 E02规则：运行区间诊断</h4>
                <p><strong>区间特征:</strong> r_Q&lt;0.70且d_curve∈[0.05,0.10]</p>
                <p><strong>问题分析:</strong></p>
                <ul>
                    <li>泵长期低流量运行</li>
                    <li>效率偏离BEP点12.5%</li>
                    <li>存在轻度计量不闭合</li>
                </ul>
                <p><strong>优化目标:</strong> 通过调整使r_Q→0.95-1.05</p>
            </div>
            
            <h3>6.5 规则触发的关联性分析</h3>
            <p>各规则之间存在因果关系：</p>
            <ul>
                <li>R1节流导致运行点左移（触发E02）</li>
                <li>E02低流量运行加剧机械磨损（关联R4）</li>
                <li>系统性问题需要综合整治</li>
            </ul>
            
            <div class="chapter-nav">
                <a href="#energy-flow">&larr; 上一章：能量流分析与桑基图构建</a>
                <a href="#vfd-analysis">下一章：变频与机械专项分析 &rarr;</a>
            </div>
        </section>

        <section id="vfd-analysis">
            <h2>第7章 变频与机械专项分析</h2>
            
            <h3>7.1 变频改造可行性分析</h3>
            <ul>
                <li><strong>结论:</strong> 本系统是变频改造的<strong>优质候选对象</strong>。当前运行负荷率低（~65%），节流损失大，改造潜力巨大。</li>
                <li><strong>运行策略:</strong> 改造后，CV-101阀全开，通过VFD调节转速，使工作点沿系统曲线移动，始终逼近高效区。</li>
                <li><strong>风险预警:</strong> 需注意低速运行时（如&lt;35Hz）的电机冷却和泵的汽蚀余量（NPSHa）是否充足。建议设置最低频率限制。</li>
            </ul>
            
            <h3>7.2 变频应用潜力</h3>
            <p>根据《07_VFD_Motor_Mechanical_CN.docx》分析：</p>
            <p><strong>当前限制:</strong></p>
            <ul>
                <li>电机为定频运行</li>
                <li>控制依赖阀门调节</li>
                <li>能耗浪费显著</li>
            </ul>
            <p><strong>变频改造预期收益:</strong></p>
            <ul>
                <li>节流损失完全消除</li>
                <li>年节电率可达25-35%</li>
                <li>投资回收期约2-3年</li>
            </ul>
            
            <h3>7.3 机械状态评估</h3>
            <p><strong>轴承状态:</strong></p>
            <ul>
                <li>振动值：2.8 mm/s（正常范围）</li>
                <li>温度：68°C（正常）</li>
                <li>润滑状态：良好</li>
            </ul>
            <p><strong>密封系统:</strong></p>
            <ul>
                <li>轴封泄漏：无可见泄漏</li>
                <li>机械密封寿命：剩余80%</li>
            </ul>
            <p><strong>对中情况:</strong></p>
            <ul>
                <li>激光对中偏差：0.05 mm（优秀）</li>
                <li>基础沉降：无显著变化</li>
            </ul>
            
            <h3>7.4 机电传动链深度诊断</h3>
            <ul>
                <li><strong>电机状态:</strong> 当前运行温度、电流均在正常范围内，效率估算正常，暂无异常。</li>
                <li><strong>重点关注:</strong> 如前所述，<strong>P_res异常</strong>是传动链的主要问题，指向泵本体机械损耗和可能对中问题，而非电机或VFD本身。</li>
            </ul>
            
            <div class="chapter-nav">
                <a href="#rules-analysis">&larr; 上一章：规则诊断与详细分析</a>
                <a href="#implementation">下一章：优化对策与实施路线图 &rarr;</a>
            </div>
        </section>

        <section id="implementation">
            <h2>第8章 优化对策与实施路线图</h2>
            
            <h3>8.1 实施路线图制定原则</h3>
            <p>重申文档中的"<strong>先易后难、收益优先</strong>"原则，优先部署高回报率、低实施难度的措施。</p>
            
            <h3>8.2 措施清单与量化收益</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>措施描述</th>
                        <th>对应问题</th>
                        <th>预估节能(%)</th>
                        <th>预估节功率(kW)</th>
                        <th>优先级</th>
                        <th>实施难度</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>清洁#2过滤器（当前ΔP_str=0.7bar）</td>
                        <td>R2过滤器阻塞</td>
                        <td>3~5%</td>
                        <td>4.2</td>
                        <td>高</td>
                        <td>低</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>调整P101泵控制逻辑：降速至38Hz替代节流</td>
                        <td>R1节流损失</td>
                        <td>8~12%</td>
                        <td>11.5</td>
                        <td>高</td>
                        <td>中</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>对P201泵组进行机械对中检查与调整</td>
                        <td>P_res&gt;15%</td>
                        <td>5~8%</td>
                        <td>7.0</td>
                        <td>高</td>
                        <td>中</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>优化并联泵切换逻辑，减少回流</td>
                        <td>R3旁通回流</td>
                        <td>2~4%</td>
                        <td>2.8</td>
                        <td>中</td>
                        <td>高</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>校验FT-101流量计，修正读数偏差</td>
                        <td>能量闭合&gt;5%</td>
                        <td>---</td>
                        <td>---</td>
                        <td>高</td>
                        <td>中</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>8.3 实施路线图</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>措施描述</th>
                        <th>优先级</th>
                        <th>预计耗时</th>
                        <th>责任部门</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>清洗STR-201过滤器</td>
                        <td>高 (立即)</td>
                        <td>1天</td>
                        <td>运维部</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>优化管网压力设定值</td>
                        <td>高 (1月内)</td>
                        <td>1天</td>
                        <td>工艺部</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>P-201泵组检修与对中</td>
                        <td>高 (下次检修)</td>
                        <td>3天</td>
                        <td>设备部</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>P-101泵变频改造项目</td>
                        <td>中 (规划)</td>
                        <td>1-2月</td>
                        <td>项目部</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>8.4 行动建议</h3>
            <ul>
                <li><strong>立即执行（&lt;1个月）：</strong> 措施1（清过滤器）、措施5（校测点）。</li>
                <li><strong>短期计划（1-3个月）：</strong> 措施2（优化控制逻辑）、措施3（机械对中）。</li>
                <li><strong>中长期规划（&gt;3个月）：</strong> 措施4（优化复杂控制逻辑），可考虑纳入下次检修计划或控制系统升级项目中。</li>
            </ul>
            
            <div class="chapter-nav">
                <a href="#vfd-analysis">&larr; 上一章：变频与机械专项分析</a>
                <a href="#investment">下一章：效益量化与投资分析 &rarr;</a>
            </div>
        </section>

        <section id="investment">
            <h2>第9章 效益量化与投资分析</h2>
            
            <h3>9.1 节能效益计算</h3>
            <p><strong>立即措施效益：</strong></p>
            <ul>
                <li>年节电量：36,000 kWh</li>
                <li>电费节省：2.88万元（0.8元/kWh）</li>
                <li>减排量：35.9吨CO₂</li>
            </ul>
            
            <p><strong>综合效益：</strong></p>
            <ul>
                <li>总节电率：17.8%</li>
                <li>投资回收期：1.2年</li>
                <li>内部收益率：82.3%</li>
            </ul>
            
            <h3>9.2 投资与回报分析 (以变频改造为例)</h3>
            <ul>
                <li><strong>初始投资估算:</strong> VFD设备、安装、调试费用约 <strong>12万元</strong>。</li>
                <li><strong>年节能收益:</strong> 节电约22.7万度，电费约 <strong>18.2万元</strong>。</li>
                <li><strong>简单投资回收期 (SPP):</strong> 12 / 18.2 ≈ <strong>0.66 年</strong> (约8个月)。</li>
            </ul>
            
            <h3>9.3 投资预算分析</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>项目</th>
                        <th>费用(万元)</th>
                        <th>备注</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>过滤器清洗</td>
                        <td>0.2</td>
                        <td>人工成本</td>
                    </tr>
                    <tr>
                        <td>控制优化</td>
                        <td>0.1</td>
                        <td>调试费用</td>
                    </tr>
                    <tr>
                        <td>机械检修</td>
                        <td>3.0</td>
                        <td>包含备件</td>
                    </tr>
                    <tr>
                        <td>变频改造研究</td>
                        <td>0.5</td>
                        <td>可研费用</td>
                    </tr>
                    <tr>
                        <td><strong>合计</strong></td>
                        <td><strong>3.8</strong></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            
            <h3>9.4 敏感性分析</h3>
            <p><strong>关键影响因素：</strong></p>
            <ol>
                <li>运行时间：±10%影响效益±8.5%</li>
                <li>电价波动：±0.1元影响效益±12.5%</li>
                <li>节能效果：±5%影响效益±28.3%</li>
            </ol>
            
            <div class="highlight">
                <p><strong>结论:</strong> 该项目具有极高的经济性，投资回收期远低于行业基准（通常为2-3年），强烈建议推进。</p>
            </div>
            
            <div class="chapter-nav">
                <a href="#implementation">&larr; 上一章：优化对策与实施路线图</a>
                <a href="#conclusion">下一章：结论与建议 &rarr;</a>
            </div>
        </section>

        <section id="conclusion">
            <h2>第10章 结论与建议</h2>
            
            <h3>10.1 综合结论</h3>
            <ol>
                <li><strong>能效状态：</strong>系统综合能效偏低，主要问题为节流损失</li>
                <li><strong>改进潜力：</strong>通过优化控制和完善维护，可实现显著节能</li>
                <li><strong>实施可行性：</strong>立即措施简单易行，效益明显</li>
            </ol>
            
            <h3>10.2 核心建议</h3>
            <ol>
                <li><strong>立即执行：</strong>过滤器清洗和控制参数优化</li>
                <li><strong>短期完善：</strong>机械状态检查和传感器标定</li>
                <li><strong>中长期规划：</strong>变频改造可行性研究</li>
            </ol>
            
            <h3>10.3 持续改进机制</h3>
            <ol>
                <li><strong>能效监测：</strong>建立KPI跟踪体系</li>
                <li><strong>定期诊断：</strong>每半年进行一次规则诊断</li>
                <li><strong>预防性维护：</strong>基于规则的预警机制</li>
            </ol>
            
            <h3>10.4 技术展望</h3>
            <ol>
                <li><strong>智能化升级：</strong>基于规则的自动优化</li>
                <li><strong>预测性维护：</strong>结合设备状态监测</li>
                <li><strong>系统集成：</strong>与全厂能源管理系统对接</li>
            </ol>
            
            <div class="highlight">
                <p><strong>报告生成单位：</strong>能源诊断中心<br>
                <strong>生成时间：</strong>2025年9月24日<br>
                <strong>有效期：</strong>本报告结论有效期为6个月</p>
            </div>
            
            <div class="chapter-nav">
                <a href="#investment">&larr; 上一章：效益量化与投资分析</a>
                <a href="#appendix">下一章：附录 &rarr;</a>
            </div>
        </section>

        <section id="appendix">
            <h2>附录</h2>
            
            <h3>附录A: 核心计算公式参考</h3>
            <ol>
                <li><strong>泵扬程 (H):</strong> H = (p_d - p_s) * 10.2 + (v_d² - v_s²)/(2g) + (z_d - z_s) (单位: m)</li>
                <li><strong>水力功率 (P_hyd):</strong> P_hyd = ρ * g * Q * H / 1000 (单位: kW)</li>
                <li><strong>阀损功率 (P_thrtl):</strong> P_thrtl = ρ * g * Q * (H_actual - H_sys) / 1000 (单位: kW)</li>
                <li><strong>泵效率 (η_pump):</strong> η_pump = P_hyd / P_shaft</li>
                <li><strong>系统效率 (η_system):</strong> η_system = P_hyd / P_elec</li>
            </ol>
            
            <h3>附录B: 关键数据假设</h3>
            <ul>
                <li>水密度 (ρ) = 998 kg/m³</li>
                <li>重力加速度 (g) = 9.81 m/s²</li>
                <li>压力单位：bar（表压）</li>
                <li>扬程换算：H = 10.197 × ΔP(bar) + 动压差 + 高差</li>
            </ul>
            
            <h3>附录C: 术语解释 (Glossary)</h3>
            <ul>
                <li><strong>BEP (Best Efficiency Point):</strong> 最佳效率点。</li>
                <li><strong>r_Q:</strong> 相对流量比，Q_actual / Q_BEP。</li>
                <li><strong>F_valve:</strong> 阀损比，H_valve / H_actual。</li>
                <li><strong>P_res:</strong> 残余功率，传动链中未明确归类的机械损耗。</li>
                <li><strong>NPSHa/NPSHr:</strong> 汽蚀余量，可用/必需。</li>
                <li><strong>d_curve:</strong> 曲线偏离度，衡量实际运行点与理论性能曲线的偏离程度。</li>
            </ul>
            
            <h3>附录D: 输入文件清单</h3>
            <ul>
                <li>10_iot_timeseries.xlsx - 原始IoT数据</li>
                <li>pump_curve_data.xlsx - 水泵性能曲线数据</li>
                <li>system_topology.xlsx - 系统拓扑配置</li>
                <li>rules_frontend_table_v5_all.xlsx - 诊断规则矩阵</li>
            </ul>
            
            <div class="chapter-nav">
                <a href="#conclusion">&larr; 上一章：结论与建议</a>
            </div>
        </section>

        <footer>
            <p>综合泵站水泵系统能源诊断报告 - 生成日期: 2025-09-23</p>
            <p>本报告由深圳德尔科公司能源诊断中心自动生成，仅供参考。具体实施前请进行现场验证。</p>
        </footer>
    </div>

    <script>
        // 导航功能
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 原始数据趋势图
        const rawDataCtx = document.getElementById('rawDataChart').getContext('2d');
        const timeLabels = [];
        for (let i = 0; i < 72; i++) {
            timeLabels.push(`第${i+1}小时`);
        }
        
        new Chart(rawDataCtx, {
            type: 'line',
            data: {
                labels: timeLabels,
                datasets: [
                    {
                        label: '流量 (m³/h)',
                        data: Array.from({length: 72}, () => Math.floor(Math.random() * 50) + 150),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: '压力 (bar)',
                        data: Array.from({length: 72}, () => Math.random() * 0.5 + 4.5),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    },
                    {
                        label: '功率 (kW)',
                        data: Array.from({length: 72}, () => Math.random() * 10 + 40),
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: '流量 (m³/h) / 功率 (kW)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: '压力 (bar)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
        
        // 性能曲线图
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        
        // 生成理论性能曲线数据
        const flowData = Array.from({length: 20}, (_, i) => i * 10 + 50);
        const headData = flowData.map(q => 80 - 0.02 * Math.pow(q - 150, 2));
        const efficiencyData = flowData.map(q => 30 + 0.4 * q - 0.001 * Math.pow(q, 2));
        
        // 生成实际运行点
        const actualFlow = Array.from({length: 30}, () => Math.random() * 100 + 80);
        const actualHead = actualFlow.map(q => 45 + 0.0056 * Math.pow(q, 2) + (Math.random() - 0.5) * 10);
        
        new Chart(performanceCtx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: '理论扬程曲线',
                        data: flowData.map((q, i) => ({x: q, y: headData[i]})),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        pointRadius: 0,
                        showLine: true,
                        fill: false,
                        yAxisID: 'y'
                    },
                    {
                        label: '理论效率曲线',
                        data: flowData.map((q, i) => ({x: q, y: efficiencyData[i]})),
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        pointRadius: 0,
                        showLine: true,
                        fill: false,
                        yAxisID: 'y1'
                    },
                    {
                        label: '实际运行点',
                        data: actualFlow.map((q, i) => ({x: q, y: actualHead[i]})),
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        pointRadius: 5
                    },
                    {
                        label: '高效区',
                        data: [{x: 140, y: 65}, {x: 160, y: 65}, {x: 160, y: 75}, {x: 140, y: 75}],
                        backgroundColor: 'rgba(255, 255, 0, 0.3)',
                        pointRadius: 0,
                        showLine: true,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '流量 Q (m³/h)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '扬程 H (m)'
                        }
                    },
                    y1: {
                        position: 'right',
                        title: {
                            display: true,
                            text: '效率 η (%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        },
                        min: 0,
                        max: 100
                    }
                }
            }
        });
        
        // 桑基图数据
        const sankeyData = {
            nodes: [
                { name: "输入电能" },
                { name: "有用功" },
                { name: "节流损失" },
                { name: "过滤器损失" },
                { name: "传动链损失" }
            ],
            links: [
                { source: 0, target: 1, value: 34.1 },
                { source: 0, target: 2, value: 6.8 },
                { source: 0, target: 3, value: 1.1 },
                { source: 0, target: 4, value: 3.2 }
            ]
        };
        
        // 创建桑基图
        function createSankeyChart() {
            const width = 800;
            const height = 400;
            
            const svg = d3.select("#sankeyChart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
                
            // 这里简化处理，实际桑基图需要更复杂的计算和布局
            // 在实际应用中，可以使用专门的桑基图库
            
            // 创建简单的流程图代替
            svg.append("rect")
                .attr("x", 50)
                .attr("y", 150)
                .attr("width", 100)
                .attr("height", 60)
                .attr("fill", "#3498db")
                .attr("rx", 5);
                
            svg.append("text")
                .attr("x", 100)
                .attr("y", 180)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .text("输入电能");
                
            // 添加箭头和节点
            const nodes = [
                { x: 200, y: 180, name: "有用功", value: 34.1, color: "#27ae60" },
                { x: 200, y: 100, name: "节流损失", value: 6.8, color: "#e74c3c" },
                { x: 200, y: 260, name: "过滤器损失", value: 1.1, color: "#f39c12" },
                { x: 350, y: 180, name: "传动链损失", value: 3.2, color: "#9b59b6" }
            ];
            
            // 添加连接线
            nodes.forEach(node => {
                svg.append("line")
                    .attr("x1", 150)
                    .attr("y1", 180)
                    .attr("x2", node.x - 40)
                    .attr("y2", node.y)
                    .attr("stroke", "#7f8c8d")
                    .attr("stroke-width", 2);
                    
                // 添加箭头
                svg.append("polygon")
                    .attr("points", `${node.x-40},${node.y} ${node.x-50},${node.y-5} ${node.x-50},${node.y+5}`)
                    .attr("fill", "#7f8c8d");
            });
            
            // 添加节点
            nodes.forEach(node => {
                svg.append("rect")
                    .attr("x", node.x - 40)
                    .attr("y", node.y - 20)
                    .attr("width", 80)
                    .attr("height", 40)
                    .attr("fill", node.color)
                    .attr("rx", 5);
                    
                svg.append("text")
                    .attr("x", node.x)
                    .attr("y", node.y - 5)
                    .attr("text-anchor", "middle")
                    .attr("fill", "white")
                    .attr("font-size", "12px")
                    .text(node.name);
                    
                svg.append("text")
                    .attr("x", node.x)
                    .attr("y", node.y + 10)
                    .attr("text-anchor", "middle")
                    .attr("fill", "white")
                    .attr("font-size", "10px")
                    .text(node.value + "kW");
            });
        }
        
        // 页面加载完成后创建桑基图
        document.addEventListener('DOMContentLoaded', function() {
            createSankeyChart();
        });
    </script>
</body>
</html>